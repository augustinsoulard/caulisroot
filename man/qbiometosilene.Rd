% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/qbiometosilene.R
\encoding{UTF-8}
\name{qbiometosilene}
\alias{qbiometosilene}
\title{Convertir des données QBiome au standard SILENE/SINP}
\usage{
qbiometosilene(
  donnees_path = file.choose(),
  standard_silene = dbGetQuery(con, "SELECT * FROM donnees.standard_donnees_silene"),
  structure = "BIODIV",
  origine = "Pu",
  diffusion = 5,
  type_loc = "précis",
  communes = dbGetQuery(con, "SELECT * FROM limiteadmin.communes_paca")
)
}
\arguments{
\item{donnees_path}{Chemin vers le fichier de données spatiales (ex. GeoPackage)
contenant au minimum les couches `Flore` (obligatoire) et `Typologie` (facultative).
Par défaut `file.choose()`.}

\item{standard_silene}{\code{data.frame} modèle du standard Silene/SINP
(toutes les colonnes attendues). Par défaut, récupéré depuis PostgreSQL via
\code{dbGetQuery(con, "SELECT * FROM donnees.standard_donnees_silene")}.}

\item{structure}{Nom de la structure productrice (champ \emph{Structure productrice}).
Défaut : \code{"BIODIV"}.}

\item{origine}{Origine de la donnée (\code{"Pr"} ou \code{"Pu"}).
Défaut : \code{"Pu"}.}

\item{diffusion}{Niveau de diffusion si \code{origine == "Pr"} (entier 1–5).
Défaut : \code{5}.}

\item{type_loc}{Précision du type de localisation (ex. \code{"précis"}).
Actuellement non utilisé dans le corps de la fonction (réservé pour
une future version).}

\item{communes}{Table des communes (codes INSEE, nom, géométrie) servant à la
jointure spatiale. Par défaut, récupérée depuis PostgreSQL via
\code{dbGetQuery(con, "SELECT * FROM limiteadmin.communes_paca")}.}
}
\value{
Un \code{data.frame} (ou \code{tibble}) conforme au standard Silene/SINP,
  avec une ligne par observation de la couche \code{Flore}.
}
\description{
Transforme une couche d'observations (GeoPackage QBiome) vers un tableau
conforme au standard **Silene/SINP**, en complétant automatiquement
les champs (UUID, structure, programme, origine, diffusion, commune/INSEE,
coordonnées L93, altitude, date, observateurs, espèce, effectifs, remarques).
}
\details{
\strong{Entrées attendues :}
\itemize{
  \item La couche \code{Flore} doit contenir (au minimum) les champs
    \code{uuid}, \code{Projet}, \code{Date}, \code{Observateur}, \code{Nom},
    \code{Nombre}, \code{Precision} et une géométrie ponctuelle.
  \item La table \code{communes} doit posséder une colonne géométrique
    \code{geom} (EWKB) et les champs \code{nom_officiel}, \code{code_insee},
    \code{code_insee_du_departement}.
}

\strong{Système de coordonnées :}
Les coordonnées produites sont renseignées dans les champs \emph{Coord X L93} /
\emph{Coord Y L93} et supposent que la couche \code{Flore} est en
\strong{Lambert-93 (EPSG:2154)}. Si ce n'est pas le cas, transformer en amont,
par exemple :
\preformatted{
  data_qbiome <- sf::st_transform(data_qbiome, 2154)
}

\strong{Hypothèses et mise en garde :}
\itemize{
  \item La géométrie est \emph{ponctuelle}; \code{sf::st_coordinates()} extrait
    (X, Y[, Z]). Si \code{Z} (altitude) est absent, la colonne \emph{Altitude}
    sera \code{NA}.
  \item Les observateurs sont séparés par virgule et espace \code{", "}.
    Adapter le séparateur si nécessaire.
  \item Le champ \emph{Diffusion donnée si Origine = Pr} est rempli quel que soit
    \code{origine}; il appartient au flux aval de n’en tenir compte que si \code{origine == "Pr"}.
}
}
\examples{
\donttest{
# 1) Connexion (exemple) puis récupération des gabarits depuis PostgreSQL
# con <- copo()  # fonction de connexion maison
# standard <- DBI::dbGetQuery(con, "SELECT * FROM donnees.standard_donnees_silene")
# communes  <- DBI::dbGetQuery(con, "SELECT * FROM limiteadmin.communes_paca")
#
# 2) Conversion depuis un GeoPackage QBiome
# out <- qbiometosilene(
#   donnees_path   = "data/qbiome.gpkg",
#   standard_silene = standard,
#   structure       = "CBNMed",
#   origine         = "Pu",
#   diffusion       = 5,
#   type_loc        = "précis",
#   communes        = communes
# )
#
# head(out)
}

}
\seealso{
\code{\link{copo}} pour la connexion PostgreSQL.
}
\author{
Augustin (package QBiome)
}
\keyword{GIS}
\keyword{SINP}
\keyword{Silene}
\keyword{data-import}
