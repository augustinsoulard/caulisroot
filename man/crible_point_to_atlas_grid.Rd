% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/crible_point_to_atlas_grid.R
\name{crible_point_to_atlas_grid}
\alias{crible_point_to_atlas_grid}
\title{Points (sf) -> Grille d'atlas par espèce (polygones sf)}
\usage{
crible_point_to_atlas_grid(
  point_data,
  lb_nom,
  grid_size = 100,
  grid = NULL,
  crs_target = 2154,
  dissolve = TRUE,
  count = TRUE,
  file_chose = FALSE,
  out_path = NULL,
  layer = "atlas_grid_by_species"
)
}
\arguments{
\item{point_data}{Objet `sf` de géométrie POINT ou MULTIPOINT, contenant au moins une colonne espèce.}

\item{lb_nom}{Colonne espèce, en *tidy-eval* non quotée (ex. `lb_nom = espece`).}

\item{grid_size}{Taille de maille pour la grille générée (numérique > 0). Unités = unités du CRS projeté utilisé
(en mètres si `crs_target = 2154`). Ignoré si `grid` est fourni.}

\item{grid}{Grille existante en `sf` (géométries POLYGON/MULTIPOLYGON). Si fourni, la grille est utilisée telle quelle
(reprojetée si nécessaire) et un identifiant `grid_id` est ajouté si absent.}

\item{crs_target}{EPSG cible pour reprojeter les points lorsque `point_data` est en lon/lat
(défaut `2154`, Lambert-93). Sert aussi d’espace de travail pour la génération de la grille.}

\item{dissolve}{`TRUE` pour dissoudre les cellules par espèce (un MULTIPOLYGON par espèce). `FALSE` pour garder une ligne
par couple (espèce, cellule).}

\item{count}{`TRUE` pour calculer et joindre `n_obs` (nombre d’occurrences par (espèce, cellule) ; si `dissolve = TRUE`,
somme par espèce). `FALSE` pour ne pas compter.}

\item{file_chose}{`TRUE` pour choisir interactivement un fichier/dossier et écrire un `.gpkg` si `out_path` est `NULL`
(ignoré en session non interactive).}

\item{out_path}{Chemin de sortie optionnel (ex. `"chemin/atlas.gpkg"`). Si `NULL` et `file_chose = TRUE`, un nom est généré
automatiquement dans le dossier choisi. Si non `NULL`, un fichier est écrit via `sf::st_write()`.}

\item{layer}{Nom de couche dans le fichier de sortie (défaut `"atlas_grid_by_species"`).}
}
\value{
Un objet `sf` de polygones :
\itemize{
  \item si `dissolve = FALSE` : une ligne par (espèce, `grid_id`) avec la géométrie de cellule ; colonne `n_obs` ajoutée si `count = TRUE` ;
  \item si `dissolve = TRUE` : une ligne par espèce (géométrie union des cellules) ; colonne `n_obs` = somme par espèce si `count = TRUE`.
}
Lorsque aucun point ne tombe dans la grille, une `sf` vide est renvoyée avec le schéma attendu.
}
\description{
Points (sf) -> Grille d'atlas par espèce (polygones sf)
}
\details{
- Si `point_data` possède un CRS géographique (lon/lat), il est reprojeté en `crs_target` avant génération/jointure.
- Si `grid` est fourni, il est reprojeté au CRS des points ; sinon une grille carrée est générée avec `st_make_grid()`
  et un identifiant `grid_id` est créé.
- La jointure spatiale utilise `st_within` (un point compte pour la cellule dans laquelle il tombe).
}
